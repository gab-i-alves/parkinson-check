<div class="min-h-screen bg-gray-100 relative overflow-hidden">
  <!-- Background decorativo -->
  <div class="absolute top-0 left-0 w-full h-full -z-10 overflow-hidden">
    <div
      class="absolute top-[-10%] right-[-5%] w-96 h-96 bg-violet-200/30 rounded-full filter blur-3xl opacity-50"
    ></div>
    <div
      class="absolute bottom-[-10%] left-[-5%] w-96 h-96 bg-purple-200/30 rounded-full filter blur-3xl opacity-40"
    ></div>
    <div
      class="absolute top-[30%] left-[10%] w-64 h-64 bg-orange-200/30 rounded-full filter blur-3xl opacity-35"
    ></div>
  </div>

  <div class="container mx-auto px-6 py-8 space-y-6 relative">
    <!-- Header -->
    <div
      class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/50 p-8"
    >
      <div class="flex items-center space-x-3">
        <div
          class="flex h-14 w-14 items-center justify-center rounded-lg bg-violet-700 shadow-lg"
        >
          <svg
            class="h-8 w-8 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Solicitações</h1>
          <p class="text-sm text-gray-600 mt-1">
            Adicione novos médicos e gerencie suas solicitações de vínculo
          </p>
        </div>
      </div>
    </div>

    <!-- Seção: Adicionar Médico -->
    <div
      class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/50 p-8"
    >
      <h2 class="text-lg font-bold text-gray-900 mb-4">Adicionar Médico</h2>
      <div class="mb-6">
        <div class="flex items-end space-x-4">
          <div class="flex-grow">
            <label
              for="search-term"
              class="block text-sm font-medium text-gray-700"
            >
              Nome do Médico
            </label>
            <div class="relative mt-1">
              <div
                class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"
              >
                <svg
                  class="h-5 w-5 text-gray-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"
                    clip-rule="evenodd"
                  />
                </svg>
              </div>
              <input
                type="text"
                id="search-term"
                [value]="searchTerm()"
                (input)="onSearchTermChange($event)"
                placeholder="Digite o nome..."
                class="block w-full rounded-md border-gray-300 py-2 pl-10 pr-3 shadow-sm focus:border-primary focus:ring-primary sm:text-sm"
              />
            </div>
          </div>

          <div class="flex-shrink-0">
            <label
              for="specialty-filter"
              class="block text-sm font-medium text-gray-700"
            >
              Especialidade
            </label>
            <select
              id="specialty-filter"
              [value]="specialty()"
              (change)="specialty.set($any($event.target).value)"
              class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base shadow-sm focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"
            >
              <option value="">Todas</option>
              <option value="Neurologia">Neurologia</option>
              <option value="Geriatria">Geriatria</option>
              <option value="Outra">Outra</option>
            </select>
          </div>

          <div class="flex-shrink-0">
            <label
              for="sortBySearch"
              class="block text-sm font-medium text-gray-700"
            >
              Ordenar por
            </label>
            <select
              id="sortBySearch"
              [value]="sortBy()"
              (change)="onSortChange($event)"
              class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base shadow-sm focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"
            >
              <option value="name">Nome</option>
              <option value="expertise_area">Especialidade</option>
              <option value="location">Localização</option>
            </select>
          </div>

          <div class="flex-shrink-0">
            <label class="block text-sm font-medium text-gray-700">
              Ordem
            </label>
            <button
              type="button"
              (click)="toggleSortOrder()"
              class="mt-1 inline-flex items-center justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 transition-all"
              title="{{ sortOrder() === 'asc' ? 'Crescente' : 'Decrescente' }}"
            >
              @if (sortOrder() === 'asc') {
              <svg
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 4.5h14.25M3 9h9.75M3 13.5h9.75m4.5-4.5v12m0 0l-3.75-3.75M17.25 21L21 17.25"
                />
              </svg>
              } @else {
              <svg
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12"
                />
              </svg>
              }
            </button>
          </div>

          <div class="flex-shrink-0">
            <button
              type="button"
              (click)="searchDoctors()"
              class="mt-6 inline-flex items-center rounded-lg bg-violet-700 px-6 py-2.5 text-sm font-semibold text-white shadow-lg hover:bg-violet-800 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 transition-all"
            >
              Pesquisar
            </button>
          </div>
        </div>
      </div>

      @if (isLoading()) {
      <div class="flex h-64 items-center justify-center">
        <div class="text-center">
          <svg
            class="mx-auto h-12 w-12 animate-spin text-violet-700"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <p class="text-gray-600 mt-4 font-medium">Buscando médicos...</p>
        </div>
      </div>
      } @else if (searchResults().length === 0 && searchTerm()) {
      <div class="py-12 text-center">
        <div
          class="flex h-16 w-16 items-center justify-center rounded-lg bg-gray-100 border-2 border-gray-200 mx-auto mb-4"
        >
          <svg
            class="h-10 w-10 text-gray-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">
          Nenhum médico encontrado
        </h3>
        <p class="text-sm text-gray-600 mt-2">
          Tente ajustar os filtros ou realizar uma nova busca.
        </p>
      </div>
      } @else if (searchResults().length > 0 && !isLoading()) {
      <div class="overflow-x-auto rounded-lg border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50/50">
            <tr>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Médico
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Especialidade
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Localização
              </th>
              <th scope="col" class="relative px-6 py-3">
                <span class="sr-only">Ações</span>
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 bg-white">
            @for (doctor of searchResults(); track doctor.id) {
            <tr class="hover:bg-gray-50">
              <td class="whitespace-nowrap px-6 py-4">
                <div class="flex items-center">
                  <div
                    class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-violet-100 text-violet-700"
                  >
                    <span class="font-semibold">{{
                      doctor.name.charAt(0).toUpperCase()
                    }}</span>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {{ doctor.name }}
                    </div>
                    <div class="text-sm text-gray-500">
                      CRM: {{ doctor.crm }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <div class="text-sm text-gray-900">
                  {{ doctor.expertise_area }}
                </div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <div class="text-sm text-gray-900">{{ doctor.location }}</div>
              </td>
              <td
                class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium space-x-3"
              >
                <button
                  (click)="viewProfile(doctor)"
                  class="inline-flex items-center text-sm font-semibold text-violet-700 hover:text-violet-800 transition-all"
                >
                  Ver Perfil
                </button>
                <button
                  (click)="requestLink(doctor.id)"
                  [disabled]="
                    doctor.status === 'pending' || doctor.status === 'linked'
                  "
                  [ngClass]="{
                    'text-violet-700 hover:text-violet-900 font-semibold':
                      doctor.status === 'unlinked',
                    'text-gray-400 cursor-not-allowed':
                      doctor.status !== 'unlinked'
                  }"
                  [ngSwitch]="doctor.status"
                  class="inline-flex items-center text-sm transition-all"
                >
                  <span *ngSwitchCase="'unlinked'">Solicitar Vínculo</span>
                  <span *ngSwitchCase="'pending'">Pendente</span>
                  <span *ngSwitchCase="'linked'">Vinculado</span>
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }
    </div>

    <!-- Seção: Solicitações Pendentes -->
    <div
      class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/50 p-8"
    >
      <h2 class="text-lg font-bold text-gray-900 mb-4">Solicitações</h2>

      <!-- Abas -->
      <div class="mb-4 border-b border-gray-200">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
          <button
            (click)="setActiveTab('sent')"
            [class]="
              activeTab() === 'sent'
                ? 'border-violet-500 text-violet-600'
                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
            "
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
          >
            Enviadas
          </button>
          <button
            (click)="setActiveTab('received')"
            [class]="
              activeTab() === 'received'
                ? 'border-violet-500 text-violet-600'
                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
            "
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
          >
            Recebidas
          </button>
        </nav>
      </div>

      <!-- Conteúdo aba Enviadas -->
      @if (activeTab() === 'sent') { @if (sentRequests().length === 0) {
      <div class="py-12 text-center">
        <div
          class="flex h-16 w-16 items-center justify-center rounded-lg bg-gray-100 border-2 border-gray-200 mx-auto mb-4"
        >
          <svg
            class="h-10 w-10 text-gray-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">
          Nenhuma solicitação pendente
        </h3>
        <p class="text-sm text-gray-600 mt-2">
          Você não possui solicitações de vínculo em andamento.
        </p>
      </div>
      } @else {
      <div class="overflow-x-auto rounded-lg border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50/50">
            <tr>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Médico
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Especialidade
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Status
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 bg-white">
            @for (request of sentRequests(); track request.id) {
            <tr class="hover:bg-gray-50">
              <td class="whitespace-nowrap px-6 py-4">
                <div class="flex items-center">
                  <div
                    class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-violet-100 text-violet-700"
                  >
                    <span class="font-semibold">{{
                      request.user.name.charAt(0).toUpperCase()
                    }}</span>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {{ request.user.name }}
                    </div>
                    <div class="text-sm text-gray-500">
                      {{ getSpecialty(request.user) }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <div class="text-sm text-gray-900">
                  {{ getSpecialty(request.user) }}
                </div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <span
                  class="inline-flex rounded-full bg-yellow-100 px-2 text-xs font-semibold leading-5 text-yellow-800"
                >
                  Pendente
                </span>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      } }

      <!-- Conteúdo aba Recebidas -->
      @if (activeTab() === 'received') { @if (receivedRequests().length === 0) {
      <div class="py-12 text-center">
        <div
          class="flex h-16 w-16 items-center justify-center rounded-lg bg-gray-100 border-2 border-gray-200 mx-auto mb-4"
        >
          <svg
            class="h-10 w-10 text-gray-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">
          Nenhuma solicitação recebida
        </h3>
        <p class="text-sm text-gray-600 mt-2">
          Você não possui solicitações de médicos no momento.
        </p>
      </div>
      } @else {
      <div class="overflow-x-auto rounded-lg border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50/50">
            <tr>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Médico
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Especialidade
              </th>
              <th
                scope="col"
                class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
              >
                Ações
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 bg-white">
            @for (request of receivedRequests(); track request.id) {
            <tr class="hover:bg-gray-50">
              <td class="whitespace-nowrap px-6 py-4">
                <div class="flex items-center">
                  <div
                    class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-violet-100 text-violet-700"
                  >
                    <span class="font-semibold">{{
                      request.user.name.charAt(0).toUpperCase()
                    }}</span>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {{ request.user.name }}
                    </div>
                    <div class="text-sm text-gray-500">
                      {{ getSpecialty(request.user) }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <div class="text-sm text-gray-900">
                  {{ getSpecialty(request.user) }}
                </div>
              </td>
              <td class="whitespace-nowrap px-6 py-4">
                <div class="flex space-x-2">
                  <button
                    (click)="viewProfile(request.user)"
                    class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-semibold rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-all"
                  >
                    Ver Perfil
                  </button>
                  <button
                    (click)="acceptRequest(request.id)"
                    class="inline-flex items-center px-4 py-2 border border-green-200 text-sm font-semibold rounded-lg text-green-700 bg-green-50/50 hover:bg-green-100 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all"
                  >
                    Aceitar
                  </button>
                  <button
                    (click)="rejectRequest(request.id)"
                    class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-semibold rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-all"
                  >
                    Recusar
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      } }
    </div>
  </div>
</div>

<app-doctor-profile-modal
  [isVisible]="isModalVisible()"
  [doctor]="selectedDoctor()"
  (close)="closeModal()"
  (requestLink)="requestLink($event)"
></app-doctor-profile-modal>
