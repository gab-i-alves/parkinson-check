<div class="space-y-6">
  @if (!timeline) {
  <div class="text-center py-8">
    <p class="text-gray-500">Carregando histórico de testes...</p>
  </div>
  } @else if (timeline.total_count === 0) {
  <div class="text-center py-12">
    <svg
      class="mx-auto h-12 w-12 text-gray-400"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
      />
    </svg>
    <h3 class="mt-2 text-sm font-medium text-gray-900">
      Nenhum teste realizado
    </h3>
    <p class="mt-1 text-sm text-gray-500">
      Você ainda não realizou nenhum teste clínico.
    </p>
  </div>
  } @else {
  <!-- Filtros -->
  <div class="bg-gray-50 rounded-lg p-4">
    <div class="flex flex-wrap gap-4">
      <div>
        <label for="filterType" class="block text-sm font-medium text-gray-700 mb-1">
          Tipo de Teste
        </label>
        <select
          id="filterType"
          [ngModel]="filterType()"
          (ngModelChange)="onFilterTypeChange($event)"
          class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
        >
          <option value="all">Todos</option>
          <option value="SPIRAL_TEST">Espiral</option>
          <option value="VOICE_TEST">Voz</option>
        </select>
      </div>

      <div>
        <label
          for="filterClassification"
          class="block text-sm font-medium text-gray-700 mb-1"
        >
          Classificação
        </label>
        <select
          id="filterClassification"
          [ngModel]="filterClassification()"
          (ngModelChange)="onFilterClassificationChange($event)"
          class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
        >
          <option value="all">Todas</option>
          <option value="HEALTHY">Saudável</option>
          <option value="PARKINSON">Parkinson</option>
        </select>
      </div>

      <div class="flex items-end">
        <p class="text-sm text-gray-600">
          {{ filteredTests().length }} teste(s) encontrado(s)
        </p>
      </div>
    </div>
  </div>

  <!-- Tabela de Testes -->
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Data
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Tipo
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Score
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Classificação
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Detalhes
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Ações
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        @for (test of paginatedTests(); track test.test_id) {
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ formatDate(test.execution_date) }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ getTestTypeLabel(test.test_type) }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ test.score.toFixed(2) }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <span
              class="inline-flex rounded-full px-2 py-1 text-xs font-semibold"
              [ngClass]="getClassificationBgColor(test.classification) + ' ' + getClassificationColor(test.classification)"
            >
              {{ test.classification }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            @if (test.test_type === 'SPIRAL_TEST') {
            <span>Duração: {{ test.draw_duration }}s</span>
            } @else if (test.test_type === 'VOICE_TEST') {
            <span>Duração: {{ test.record_duration }}s</span>
            }
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <button
              (click)="viewTestDetails(test.test_id)"
              class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Ver Detalhes
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginação -->
  @if (totalPages() > 1) {
  <div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3">
    <div class="flex flex-1 justify-between sm:hidden">
      <button
        (click)="previousPage()"
        [disabled]="currentPage() === 1"
        [class.opacity-50]="currentPage() === 1"
        [class.cursor-not-allowed]="currentPage() === 1"
        class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
      >
        Anterior
      </button>
      <button
        (click)="nextPage()"
        [disabled]="currentPage() === totalPages()"
        [class.opacity-50]="currentPage() === totalPages()"
        [class.cursor-not-allowed]="currentPage() === totalPages()"
        class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
      >
        Próxima
      </button>
    </div>
    <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
      <div>
        <p class="text-sm text-gray-700">
          Mostrando
          <span class="font-medium">{{
            (currentPage() - 1) * pageSize() + 1
          }}</span>
          até
          <span class="font-medium">{{
            Math.min(currentPage() * pageSize(), filteredTests().length)
          }}</span>
          de
          <span class="font-medium">{{ filteredTests().length }}</span>
          resultados
        </p>
      </div>
      <div>
        <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm">
          <button
            (click)="previousPage()"
            [disabled]="currentPage() === 1"
            class="relative inline-flex items-center rounded-l-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            ←
          </button>
          <span
            class="relative inline-flex items-center border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700"
          >
            {{ currentPage() }} / {{ totalPages() }}
          </span>
          <button
            (click)="nextPage()"
            [disabled]="currentPage() === totalPages()"
            class="relative inline-flex items-center rounded-r-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            →
          </button>
        </nav>
      </div>
    </div>
  </div>
  } }
</div>
