<div class="mx-auto max-w-4xl space-y-8 p-4 sm:p-6 lg:p-8">
  <header class="flex items-center justify-between pb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">
        Teste da Espiral: Desenho com a Câmera
      </h1>
      <p class="mt-2 text-lg text-gray-600">
        Use o seu dedo indicador para traçar sobre a espiral guia.
      </p>
    </div>
    <button
      (click)="goBackToMethodSelection()"
      class="flex items-center space-x-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="h-4 w-4"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"
        />
      </svg>
      <span>Voltar</span>
    </button>
  </header>

  <div class="relative flex justify-center">
    <video #videoElement class="hidden" autoplay playsinline></video>
    <canvas
      #canvasElement
      width="640"
      height="480"
      class="rounded-lg border-2 border-gray-300 bg-gray-900"
    ></canvas>
  </div>

  <div class="mt-6 flex justify-center gap-4">
    <button
      (click)="startDrawing()"
      class="rounded-md bg-green-600 px-5 py-2 text-base font-semibold text-white shadow-sm hover:bg-green-700"
    >
      Iniciar Desenho
    </button>
    <button
      (click)="stopDrawing()"
      class="rounded-md bg-yellow-500 px-5 py-2 text-base font-semibold text-white shadow-sm hover:bg-yellow-600"
    >
      Parar de Desenhar
    </button>
    <button
      (click)="clearCanvas()"
      class="rounded-md bg-gray-500 px-5 py-2 text-base font-semibold text-white shadow-sm hover:bg-gray-600"
    >
      Limpar
    </button>
    <button
      (click)="uploadImage()"
      [disabled]="uploadStatus() === 'uploading'"
      class="rounded-md bg-violet-600 px-5 py-2 text-base font-semibold text-white shadow-sm hover:bg-violet-700 disabled:opacity-50"
    >
      @if (uploadStatus() === 'uploading') { Enviando... } @else { Enviar para
      Análise }
    </button>
  </div>

  @if (feedbackMessage()) {
  <div
    class="rounded-lg p-4"
    [class.bg-green-100]="uploadStatus() === 'success'"
    [class.text-green-800]="uploadStatus() === 'success'"
    [class.bg-red-100]="uploadStatus() === 'error'"
    [class.text-red-800]="uploadStatus() === 'error'"
    [class.bg-blue-100]="uploadStatus() === 'uploading'"
    [class.text-blue-800]="uploadStatus() === 'uploading'"
  >
    <p class="font-medium">{{ feedbackMessage() }}</p>
  </div>
  } @if (analysisResults()) {
  <div class="mt-6 rounded-lg bg-white p-6 shadow-md">
    <h3 class="text-lg font-semibold text-gray-800">Resultado da Análise</h3>
    <p>
      <strong>Pontuação (Score):</strong>
      {{ analysisResults()?.score | number : "1.2-2" }}
    </p>
    <p><strong>Análise:</strong> {{ analysisResults()?.analysis }}</p>
    <div class="mt-6 flex justify-end">
      <button
        (click)="goBackToMethodSelection()"
        class="rounded-md bg-gray-200 px-6 py-3 text-lg font-semibold text-gray-800 shadow-sm hover:bg-gray-300"
      >
        Finalizar Teste
      </button>
    </div>
  </div>
  }
</div>
