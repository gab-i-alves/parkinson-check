<div class="min-h-screen bg-neutral-50">
  <div class="container max-w-5xl mx-auto px-6 py-8">
    @if (result(); as res) {
    <div class="bg-white rounded-2xl shadow-sm border border-neutral-200 overflow-hidden">
      <!-- Header -->
      <div class="bg-gradient-to-r from-neutral-900 to-neutral-800 p-8 text-white">
        <h1 class="text-2xl font-bold mb-2">Resultado do Teste Clínico</h1>
        <p class="text-neutral-200">
          Teste de {{ testType() === "spiral" ? "Espiral" : "Voz" }}
          @if (res.execution_date) { realizado em {{ formatDate(res.execution_date) }} }
        </p>
      </div>

      <!-- Info Cards -->
      <div class="p-8 border-b border-neutral-200">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-neutral-50 p-6 rounded-xl border border-neutral-200">
            <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2">
              ID do Teste
            </p>
            <p class="text-2xl font-bold text-neutral-900">#{{ res.test_id }}</p>
          </div>
          <div class="bg-neutral-50 p-6 rounded-xl border border-neutral-200">
            <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2">
              ID do Paciente
            </p>
            <p class="text-2xl font-bold text-neutral-900">
              #{{ res.patient_id }}
            </p>
          </div>
          <div class="bg-neutral-50 p-6 rounded-xl border border-neutral-200">
            <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2">
              Classificação
            </p>
            <p class="text-2xl font-bold text-neutral-900">
              {{ getClassificationLabel() }}
            </p>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div class="p-8">
        @if (isSpiralResult(res)) {
        <!-- Spiral Test Results -->
        <div class="mb-6">
          <h3 class="text-xl font-bold text-neutral-900 mb-6">
            Análise da Espiral
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-green-50 p-6 rounded-xl border border-green-200">
              <p class="text-xs font-medium text-neutral-600 uppercase tracking-wider mb-2">
                Votos para "Saudável"
              </p>
              <p class="text-3xl font-bold text-green-600">
                {{ res.vote_count.Healthy }}
              </p>
            </div>
            <div class="bg-red-50 p-6 rounded-xl border border-red-200">
              <p class="text-xs font-medium text-neutral-600 uppercase tracking-wider mb-2">
                Votos para "Parkinson"
              </p>
              <p class="text-3xl font-bold text-red-600">
                {{ res.vote_count.Parkinson }}
              </p>
            </div>
          </div>

          <h4 class="text-lg font-bold text-neutral-800 mb-4">
            Resultados por Modelo
          </h4>
          <div class="overflow-x-auto rounded-xl border border-neutral-200">
            <table class="min-w-full divide-y divide-neutral-200">
              <thead class="bg-neutral-50">
                <tr>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider"
                  >
                    Modelo
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider"
                  >
                    Previsão
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider"
                  >
                    Probabilidades
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-neutral-200">
                @for (modelKey of getModelKeys(res); track modelKey) {
                <tr class="hover:bg-neutral-50 transition-colors">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-neutral-900">
                    {{ modelKey }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <app-badge [variant]="getPredictionVariant(res.model_results[modelKey].prediction)">
                      {{ getPredictionLabel(res.model_results[modelKey].prediction) }}
                    </app-badge>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-600">
                    @if (res.model_results[modelKey].probabilities; as probs) {
                    <span class="font-mono">
                      H: {{ probs["Healthy"] | percent : "1.0-2" }} | P:
                      {{ probs["Parkinson"] | percent : "1.0-2" }}
                    </span>
                    } @else {
                    <span class="text-neutral-400">N/A</span>
                    }
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
        } @else {
        <!-- Voice Test Results -->
        <div class="mb-6">
          <h3 class="text-xl font-bold text-neutral-900 mb-6">Análise de Voz</h3>
          <div class="bg-blue-50 p-6 rounded-xl mb-6 border border-blue-200">
            <p class="text-xs font-medium text-neutral-600 uppercase tracking-wider mb-2">
              Score do Teste
            </p>
            <p class="text-3xl font-bold text-blue-600">
              {{ (res.score * 100).toFixed(1) }}%
            </p>
          </div>
          <div class="bg-neutral-50 p-6 rounded-xl border border-neutral-200">
            <p class="text-xs font-medium text-neutral-600 uppercase tracking-wider mb-3">
              Análise Detalhada:
            </p>
            <p class="text-sm text-neutral-800 leading-relaxed">
              {{ res.analysis || "Análise não disponível" }}
            </p>
          </div>
        </div>
        }
      </div>

      <!-- Footer Actions -->
      <div class="flex justify-between items-center p-8 border-t border-neutral-200 bg-neutral-50">
        <button
          (click)="viewPatientHistory()"
          class="inline-flex items-center rounded-lg border border-neutral-300 px-6 py-2.5 text-sm font-semibold text-neutral-700 bg-white hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-200 transition-all"
        >
          Ver Histórico do Paciente
        </button>
        <button
          (click)="backToDashboard()"
          class="inline-flex items-center rounded-full bg-neutral-900 px-6 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-neutral-800 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-200 transition-all"
        >
          Voltar ao Dashboard
        </button>
      </div>
    </div>
    } @else {
    <!-- Loading State -->
    <div class="text-center py-12">
      <div
        class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-solid border-pink-600 border-r-transparent"
      ></div>
      <p class="text-neutral-600 mt-4 text-sm font-medium">
        Carregando resultado...
      </p>
    </div>
    }
  </div>
</div>
