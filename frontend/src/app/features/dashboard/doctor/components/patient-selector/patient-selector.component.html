<div class="max-w-4xl mx-auto p-6">
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">
      Selecionar Paciente para Teste Clínico
    </h2>

    <!-- Campo de busca -->
    <div class="mb-6">
      <label for="search" class="block text-sm font-medium text-gray-700 mb-2">
        Buscar paciente
      </label>
      <input
        id="search"
        type="text"
        [(ngModel)]="searchQuery"
        (input)="searchQuery.set($any($event.target).value)"
        placeholder="Digite o nome ou CPF do paciente..."
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      />
    </div>

    <!-- Loading state -->
    @if (isLoading()) {
    <div class="text-center py-8">
      <div
        class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
      ></div>
      <p class="text-gray-600 mt-2">Carregando pacientes...</p>
    </div>
    } @else if (filteredPatients().length > 0) {
    <div class="mb-6">
      <p class="text-sm text-gray-600 mb-3">
        {{ filteredPatients().length }} paciente(s) encontrado(s)
      </p>

      <div class="space-y-2 max-h-96 overflow-y-auto">
        @for (patient of filteredPatients(); track patient.id) {
        <div
          (click)="selectPatient(patient.id)"
          [class.ring-2]="selectedPatientId() === +patient.id"
          [class.ring-blue-500]="selectedPatientId() === +patient.id"
          [class.bg-blue-50]="selectedPatientId() === +patient.id"
          class="p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"
        >
          <div class="flex justify-between items-center">
            <div>
              <h3 class="font-semibold text-gray-800">{{ patient.name }}</h3>
              <p class="text-sm text-gray-600">CPF: {{ patient.cpf }}</p>
              <p class="text-xs text-gray-500 mt-1">
                Último teste: {{ patient.lastTestDate }} ({{
                  patient.lastTestType
                }})
              </p>
            </div>

            @if (selectedPatientId() === +patient.id) {
            <div class="flex-shrink-0">
              <svg
                class="w-6 h-6 text-blue-600"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            }
          </div>
        </div>
        }
      </div>
    </div>
    } @else {
    <div class="text-center py-8">
      <p class="text-gray-600">Nenhum paciente encontrado.</p>
      @if (searchQuery()) {
      <p class="text-sm text-gray-500 mt-2">Tente buscar com outro termo.</p>
      }
    </div>
    }

    <!-- Botões de ação -->
    <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200">
      <button
        (click)="cancel()"
        class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
      >
        Cancelar
      </button>

      <button
        (click)="proceedToTestSelection()"
        [disabled]="!canProceed()"
        [class.opacity-50]="!canProceed()"
        [class.cursor-not-allowed]="!canProceed()"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:hover:bg-blue-600"
      >
        Iniciar Teste
      </button>
    </div>
  </div>
</div>
