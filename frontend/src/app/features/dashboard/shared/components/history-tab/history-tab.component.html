<div class="space-y-6">
  @if (!timeline) {
  <div class="text-center py-8">
    <p class="text-gray-500">Carregando histórico de testes...</p>
  </div>
  } @else if (timeline.total_count === 0) {
  <div class="text-center py-12">
    <svg
      class="mx-auto h-12 w-12 text-gray-400"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
      />
    </svg>
    <h3 class="mt-2 text-sm font-medium text-gray-900">
      Nenhum teste realizado
    </h3>
    <p class="mt-1 text-sm text-gray-500">
      Este paciente ainda não realizou nenhum teste.
    </p>
  </div>
  } @else {
  <!-- Filtros -->
  <div class="bg-gray-50 rounded-lg p-4">
    <div class="flex items-end space-x-4">
      <div class="flex-shrink-0">
        <label for="filterType" class="block text-sm font-medium text-gray-700">
          Tipo de Teste
        </label>
        <select
          id="filterType"
          [ngModel]="filterType()"
          (ngModelChange)="onFilterTypeChange($event)"
          class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base shadow-sm focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"
        >
          <option value="all">Todos</option>
          <option value="SPIRAL_TEST">Espiral</option>
          <option value="VOICE_TEST">Voz</option>
        </select>
      </div>

      <div class="flex-shrink-0">
        <label
          for="filterClassification"
          class="block text-sm font-medium text-gray-700"
        >
          Classificação
        </label>
        <select
          id="filterClassification"
          [ngModel]="filterClassification()"
          (ngModelChange)="onFilterClassificationChange($event)"
          class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base shadow-sm focus:border-primary focus:outline-none focus:ring-primary sm:text-sm"
        >
          <option value="all">Todas</option>
          <option value="HEALTHY">Saudável</option>
          <option value="PARKINSON">Parkinson</option>
        </select>
      </div>

      <div class="flex items-end flex-grow">
        <p class="text-sm text-gray-600 pb-2">
          {{ filteredTests().length }} teste(s) encontrado(s)
        </p>
      </div>
    </div>
  </div>

  <!-- Tabela de Testes -->
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            ID
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Data
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Tipo
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Score
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Classificação
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Duração da Gravação
          </th>
          <th
            scope="col"
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Ações
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        @for (test of paginatedTests(); track test.test_id) {
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
            #{{ test.test_id }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ formatDate(test.execution_date) }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ getTestTypeLabel(test.test_type) }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ test.score.toFixed(2) }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <span
              class="inline-flex rounded-full px-2 py-1 text-xs font-semibold"
              [ngClass]="getClassificationBgColor(test.classification) + ' ' + getClassificationColor(test.classification)"
            >
              {{ getClassificationLabel(test.classification) }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            @if (isSpiralTest(test.test_type)) {
            <span>{{ test.draw_duration }}s</span>
            } @else if (isVoiceTest(test.test_type)) {
            <span>{{ test.record_duration }}s</span>
            } @else {
            <span>-</span>
            }
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <button
              (click)="viewTestDetails(test.test_id)"
              class="inline-flex items-center px-4 py-2 border border-violet-200 text-sm font-semibold rounded-lg text-violet-700 bg-violet-50/50 hover:bg-violet-100 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-all"
            >
              Ver Detalhes
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginação -->
  @if (totalPages() > 1) {
  <div
    class="mt-6 flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"
  >
    <div class="flex flex-1 justify-between sm:hidden">
      <button
        (click)="previousPage()"
        [disabled]="currentPage() === 1"
        [class.opacity-50]="currentPage() === 1"
        [class.cursor-not-allowed]="currentPage() === 1"
        class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
      >
        Anterior
      </button>
      <button
        (click)="nextPage()"
        [disabled]="currentPage() === totalPages()"
        [class.opacity-50]="currentPage() === totalPages()"
        [class.cursor-not-allowed]="currentPage() === totalPages()"
        class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
      >
        Próxima
      </button>
    </div>
    <div
      class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"
    >
      <div class="flex items-center gap-4">
        <p class="text-sm text-gray-700">
          Mostrando
          <span class="font-medium">{{
            (currentPage() - 1) * pageSize() + 1
          }}</span>
          até
          <span class="font-medium">{{
            Math.min(currentPage() * pageSize(), filteredTests().length)
          }}</span>
          de
          <span class="font-medium">{{ filteredTests().length }}</span>
          resultados
        </p>
        <div class="flex items-center gap-2">
          <label for="pageSize" class="text-sm text-gray-700"
            >Itens por página:</label
          >
          <select
            id="pageSize"
            [value]="pageSize()"
            (change)="onPageSizeChange($event)"
            class="rounded-md border-gray-300 py-1 pl-2 pr-8 text-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500"
          >
            @for (size of pageSizeOptions; track size) {
            <option [value]="size">{{ size }}</option>
            }
          </select>
        </div>
      </div>
      <div>
        <nav
          class="isolate inline-flex -space-x-px rounded-md shadow-sm"
          aria-label="Paginação"
        >
          <button
            (click)="previousPage()"
            [disabled]="currentPage() === 1"
            class="relative inline-flex items-center rounded-l-md px-3 py-2 text-gray-700 bg-white ring-1 ring-inset ring-gray-300 shadow-sm hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:cursor-not-allowed disabled:opacity-50 transition-all"
          >
            <span class="sr-only">Anterior</span>
            <svg
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
                clip-rule="evenodd"
              />
            </svg>
          </button>

          @for (page of [].constructor(totalPages()); track $index) {
          <button
            (click)="goToPage($index + 1)"
            [class.bg-violet-600]="currentPage() === $index + 1"
            [class.text-white]="currentPage() === $index + 1"
            [class.bg-white]="currentPage() !== $index + 1"
            [class.text-gray-900]="currentPage() !== $index + 1"
            class="relative inline-flex items-center px-4 py-2 text-sm font-semibold ring-1 ring-inset ring-gray-300 shadow-sm hover:bg-gray-50 focus:z-20 focus:outline-offset-0 transition-all"
          >
            {{ $index + 1 }}
          </button>
          }

          <button
            (click)="nextPage()"
            [disabled]="currentPage() === totalPages()"
            class="relative inline-flex items-center rounded-r-md px-3 py-2 text-gray-700 bg-white ring-1 ring-inset ring-gray-300 shadow-sm hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:cursor-not-allowed disabled:opacity-50 transition-all"
          >
            <span class="sr-only">Próxima</span>
            <svg
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </nav>
      </div>
    </div>
  </div>
  } }
</div>
