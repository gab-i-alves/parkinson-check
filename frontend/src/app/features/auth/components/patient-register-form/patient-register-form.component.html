<form
  [formGroup]="patientForm()"
  (ngSubmit)="onSubmit()"
  class="mt-8 space-y-8"
  novalidate
>
  @if (apiError(); as error) {
  <div class="rounded-md bg-red-50 p-4">
    <p class="text-sm font-medium text-red-800">{{ error }}</p>
  </div>
  }

  <section>
    <h3 class="text-lg font-semibold text-gray-800">Dados Pessoais</h3>
    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
      <div class="sm:col-span-2">
        <label for="fullName" class="block text-sm font-medium text-gray-700"
          >Nome Completo*</label
        >
        <input
          id="fullName"
          name="fullName"
          formControlName="fullName"
          type="text"
          required
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
          placeholder="Digite seu nome completo"
        />
        @if (patientForm().get('fullName')?.invalid &&
        patientForm().get('fullName')?.touched) {
        <div class="mt-1 text-xs text-red-600">
          @if (patientForm().get('fullName')?.hasError('required')) {
          <span>Campo obrigatório.</span>
          }
        </div>
        }
      </div>
      <div>
        <label for="cpf" class="block text-sm font-medium text-gray-700"
          >CPF*</label
        >
        <input
          id="cpf"
          name="cpf"
          type="text"
          formControlName="cpf"
          mask="000.000.000-00"
          required
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
          placeholder="000.000.000-00"
        />
        @if (patientForm().get('cpf')?.invalid &&
        patientForm().get('cpf')?.touched) {
        <div class="mt-1 text-xs text-red-600">
          @if (patientForm().get('cpf')?.hasError('required')) {
          <span>Campo obrigatório.</span>
          } @if (patientForm().get('cpf')?.hasError('cpfInvalid')) {
          <span>CPF inválido.</span>
          }
        </div>
        }
      </div>
    </div>
    <div>
      <label for="birthDate" class="block text-sm font-medium text-gray-700"
        >Data de Nascimento*</label
      >
      <input
        id="birthDate"
        name="birthDate"
        formControlName="birthDate"
        type="date"
        required
        class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
      />
      @if (patientForm().get('birthDate')?.invalid &&
      patientForm().get('birthDate')?.touched) {
      <div class="mt-1 text-xs text-red-600">
        @if (patientForm().get('birthDate')?.hasError('required')) {
        <span>Campo obrigatório.</span>
        }
      </div>
      }
    </div>
  </section>

  <section>
    <h3 class="text-lg font-semibold text-gray-800">Endereço</h3>
    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
      <div class="sm:col-span-2">
        <label for="cep" class="block text-sm font-medium text-gray-700"
          >CEP*</label
        >
        <input
          type="text"
          id="cep"
          mask="00000-000"
          formControlName="cep"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
          placeholder="00000-000"
        />
      </div>

      <div class="sm:col-span-4">
        <label for="street" class="block text-sm font-medium text-gray-700"
          >Rua*</label
        >
        <input
          type="text"
          id="street"
          formControlName="street"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        />
      </div>

      <div class="sm:col-span-2">
        <label for="number" class="block text-sm font-medium text-gray-700"
          >Número*</label
        >
        <input
          type="text"
          id="number"
          formControlName="number"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        />
      </div>
      <div class="sm:col-span-4">
        <label for="complement" class="block text-sm font-medium text-gray-700"
          >Complemento</label
        >
        <input
          type="text"
          id="complement"
          formControlName="complement"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        />
      </div>

      <div class="sm:col-span-2">
        <label
          for="neighborhood"
          class="block text-sm font-medium text-gray-700"
          >Bairro*</label
        >
        <input
          type="text"
          id="neighborhood"
          formControlName="neighborhood"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        />
      </div>
      <div class="sm:col-span-2">
        <label for="city" class="block text-sm font-medium text-gray-700"
          >Cidade*</label
        >
        <input
          type="text"
          id="city"
          formControlName="city"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        />
      </div>
      <div class="sm:col-span-2">
        <label for="state" class="block text-sm font-medium text-gray-700"
          >Estado*</label
        >
        <input
          type="text"
          id="state"
          formControlName="state"
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        />
      </div>
    </div>
  </section>

  <section>
    <h3 class="text-lg font-semibold text-gray-800">Segurança</h3>
    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
      <div class="sm:col-span-2">
        <label for="email" class="block text-sm font-medium text-gray-700"
          >E-mail*</label
        >
        <input
          id="email"
          name="email"
          type="email"
          formControlName="email"
          required
          class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
          placeholder="Digite seu e-mail"
        />
        @if (patientForm().get('email')?.invalid &&
        patientForm().get('email')?.touched) {
        <div class="mt-1 text-xs text-red-600">
          @if (patientForm().get('email')?.hasError('required')) {
          <span>Campo obrigatório.</span>
          } @if (patientForm().get('email')?.hasError('email')) {
          <span>Por favor, insira um e-mail válido.</span>
          }
        </div>
        }
      </div>
    </div>
    <div>
      <label for="password" class="block text-sm font-medium text-gray-700"
        >Senha*</label
      >
      <input
        id="password"
        name="password"
        type="password"
        formControlName="password"
        required
        class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        placeholder="Digite sua senha"
      />
      @if (patientForm().get('password')?.invalid &&
      patientForm().get('password')?.touched) {
      <div class="mt-1 text-xs text-red-600">
        @if (patientForm().get('password')?.hasError('required')) {
        <span>Campo obrigatório.</span>
        } @if (patientForm().get('password')?.hasError('strong')) {
        <span
          >A senha deve ter no mínimo 8 caracteres, uma maiúscula, uma minúscula
          e um número.</span
        >
        }
      </div>
      }
    </div>
    <div>
      <label
        for="confirmPassword"
        class="block text-sm font-medium text-gray-700"
        >Confirme sua Senha*</label
      >
      <input
        type="password"
        id="confirmPassword"
        formControlName="confirmPassword"
        class="block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-violet-500 focus:outline-none focus:ring-violet-500 sm:text-sm"
        placeholder="Digite sua senha novamente"
      />
      @if (patientForm().get('confirmPassword')?.invalid &&
      patientForm().get('confirmPassword')?.touched) {
      <div class="mt-1 text-xs text-red-600">
        @if (patientForm().get('confirmPassword')?.hasError('required')) {
        <span>Campo obrigatório.</span>
        }
      </div>
      } @if (patientForm().hasError('mismatch') &&
      patientForm().get('confirmPassword')?.touched) {
      <div class="mt-1 text-xs text-red-600">
        <span>As senhas não coincidem.</span>
      </div>
      }
    </div>
  </section>

  <div
    class="flex items-center justify-end space-x-4 border-t border-gray-200 pt-6"
  >
    <a
      routerLink="/auth/login"
      class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2"
    >
      Já tenho conta
    </a>
    <button
      type="submit"
      [disabled]="patientForm().invalid || isLoading()"
      class="rounded-md border border-transparent bg-violet-700 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-violet-800 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2"
    >
      @if (isLoading()) {
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"></svg>
      } @else {
      <span>Criar conta</span>
      }
    </button>
  </div>
</form>
